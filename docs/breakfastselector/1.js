// Generated by CoffeeScript 1.6.3
var bread, onFailure, onMessage, onSuccess, onigiri, render, scratch, setup, view;

onSuccess = function(midiAccess) {
  return setup(midiAccess);
};

onFailure = function(msg) {
  document.querySelector('.items').style.display = 'none';
  return document.querySelector('.error-message').style.display = 'block';
};

if (navigator.requestMIDIAccess) {
  navigator.requestMIDIAccess().then(onSuccess, onFailure);
} else {
  onFailure();
}

setup = function(midi) {
  midi.inputs.forEach(function(input) {
    return input.onmidimessage = onMessage;
  });
  return window.requestAnimationFrame(render);
};

view = {
  position: 0,
  angles: [0, 0],
  speeds: [0, 0]
};

onMessage = function(event) {
  var data;
  data = event.data;
  if (data[0] === 182) {
    view.position = data[2];
  }
  if (data[0] === 183) {
    scratch(0, data[2]);
  }
  if (data[0] === 184) {
    return scratch(1, data[2]);
  }
};

scratch = function(ab, value) {
  return view.speeds[ab] += (value === 1 ? 1 : -1);
};

bread = document.querySelector('#bread');

onigiri = document.querySelector('#onigiri');

render = function() {
  view.angles[0] += view.speeds[0];
  view.angles[1] += view.speeds[1];
  view.speeds[0] *= 0.99;
  view.speeds[1] *= 0.99;
  bread.style.width = (127 - view.position) * 8 + 'px';
  onigiri.style.width = view.position * 8 + 'px';
  bread.style.transform = 'rotate(' + Math.floor(view.angles[0]) + 'deg)';
  onigiri.style.transform = 'rotate(' + Math.floor(view.angles[1]) + 'deg)';
  return window.requestAnimationFrame(render);
};
